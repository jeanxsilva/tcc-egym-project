<app-base-card title="{{'Registrando novo treino'}}">
    <div class="col-12">
        <div class="pl-lg-4">
            <div class="row">
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label" for="student">Escolha um aluno <span
                                class="text-danger">*</span></label>
                        <select id="student" name="student" class="form-control form-control-alternative"
                            [(ngModel)]="student" (change)="onChangeStudent()">
                            <option *ngFor="let student of studentList" [ngValue]="student">{{student.code + ' / ' +
                                student.user.name}}
                            </option>
                        </select>
                        <span class="text-muted" style="font-size: 12px;">Somente alunos com avaliação fisica
                            prévia.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12" *ngIf="student">
        <hr class="my-4">
        <h6 class="heading-small text-muted mb-4">Dados do aluno</h6>
        <div class="pl-lg-4">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="form-control-label">Nome</label>
                        <p class="text-muted">{{student.user.name + ' ' +student.user.lastName}}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="form-control-label">Matricula</label>
                        <p class="text-muted">{{student.code}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12" *ngIf="student && lastPhysicalAssesment">
        <hr class="my-4">
        <h6 class="heading-small text-muted mb-4">Ultima avaliação fisica</h6>

        <div class="pl-lg-4">
            <div class="row">
                <div class="col-lg-12">
                    <div class="form-group">
                        <label class="form-control-label" for="studentGoal">Objetivo</label>
                        <span class="span-group-text">
                            {{lastPhysicalAssesment.studentGoal}}
                        </span>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label" for="leanMass">Massa magra</label>
                        <div class="input-group">
                            <input class="form-control form-control-alternative" type="number" name="leanMass"
                                placeholder="Ex: 10.0" id="leanMass" readonly
                                [value]="lastPhysicalAssesment.studentCaracteristics.leanMass | number: '1.3-3'">
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    kg
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label" for="fatMass">Massa gorda</label>
                        <div class="input-group">
                            <input class="form-control form-control-alternative" type="number" name="fatMass"
                                placeholder="Ex: 10.0" id="fatMass" readonly
                                [value]="lastPhysicalAssesment.studentCaracteristics.fatMass | number: '1.3-3'">
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    kg
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label" for="fatPercentage">Percentual de gordura</label>
                        <div class="input-group">
                            <input class="form-control form-control-alternative" type="number" name="fatPercentage"
                                placeholder="Ex: 10.0" id="fatPercentage" readonly
                                [value]="lastPhysicalAssesment.studentCaracteristics.fatPercentage | number: '1.3-3'">
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    %
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label" for="bodyMassIndex">Indice de massa
                            corporal</label>
                        <div class="input-group">
                            <input class="form-control form-control-alternative" type="number" name="bodyMassIndex"
                                placeholder="Ex: 10.0" id="bodyMassIndex" readonly
                                [value]="lastPhysicalAssesment.studentCaracteristics.bodyMassIndex | number: '1.3-3'">
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    kg/m²
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label" for="basalMetabolicRate">Taxa metabólica
                            basal</label>
                        <div class="input-group">
                            <input class="form-control form-control-alternative" type="number" name="basalMetabolicRate"
                                placeholder="Ex: 10.0" id="basalMetabolicRate" readonly
                                value="{{lastPhysicalAssesment.studentCaracteristics.basalMetabolicRate}}">
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    calorias/dia
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label" for="bodyDensity">Densidade corporal</label>
                        <div class="input-group">
                            <input class="form-control form-control-alternative" type="number" name="bodyDensity"
                                placeholder="Ex: 10.0" id="bodyDensity" readonly
                                [value]="lastPhysicalAssesment.studentCaracteristics.bodyDensity | number: '1.3-3'">
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    g/ml
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12" *ngIf="student">
        <hr class="my-4">
        <h6 class="heading-small text-muted mb-4">Dados do treino</h6>
        <form [formGroup]="formEntity">
            <div class="pl-lg-4">
                <div class="row">
                    <div class="col-3">
                        <div class="form-group">
                            <label class="form-control-label" for="description">Descrição do treino <span
                                    class="text-danger">*</span></label>
                            <input type="text" id="description" class="form-control form-control-alternative"
                                placeholder="Ex: Primeiro treino do aluno" formControlName="description">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 rounded" style="box-shadow: inset 0px 0px 50px 3px #acacac26;">
                        <div class="scrolling-wrapper p-2" #scrolling>
                            <div class="card mr-2" style="border: 1px solid #e9ecef;" *ngFor="let day of days">
                                <div class="card-header">
                                    <div class="row">
                                        <div class="col-6">
                                            {{day.description}}
                                        </div>
                                        <div class="col-6 text-right">
                                            <button class="btn btn-sm btn-outline-warning mr-3"
                                                *ngIf="currentDay != day.number"
                                                (click)="currentDay = day.number">Alterar</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <ng-container
                                        *ngFor="let trainingPlanExercise of formEntity.get('trainingPlanExercises').controls ; let i = index;"
                                        formArrayName="trainingPlanExercises">

                                        <div class="row p-3 bg-lighter rounded-top mt-1"
                                            *ngIf="trainingPlanExercise.get('dayOfWeek') && trainingPlanExercise.get('dayOfWeek').value == day.number"
                                            [formGroupName]="i"
                                            [ngClass]="{'rounded-bottom': trainingPlanExercise.get('isCombined').value === false}">
                                            <div class="col-3">
                                                <label class="form-control-label" for="exerciseCategory">
                                                    Categoria <span class="text-danger">*</span></label>
                                                <p class="text-break">{{trainingPlanExercise.get('exerciseCategory') ?
                                                    trainingPlanExercise.get('exerciseCategory').value['description']
                                                    :
                                                    ''}}
                                                </p>
                                            </div>
                                            <div class="col-3">
                                                <label class="form-control-label" for="exercise">
                                                    Exercicio <span class="text-danger">*</span></label>
                                                <p class="text-break text-truncate">{{trainingPlanExercise.get('exercise') ?
                                                    trainingPlanExercise.get('exercise').value['description']
                                                    : ''}}</p>
                                            </div>
                                            <div class="col-2">
                                                <label class="form-control-label" for="repetition">
                                                    Repetição <span class="text-danger">*</span>
                                                </label>
                                                <p>{{trainingPlanExercise.get('repetition').value}}</p>
                                            </div>
                                            <div class="col-2">
                                                <label class="form-control-label" for="isCombined">
                                                    É combinado?
                                                </label>
                                                <p>{{trainingPlanExercise.get('isCombined').value ? 'Sim': 'Não'}}
                                                </p>
                                            </div>
                                            <div class="col-2 text-center" *ngIf="currentDay == day.number">
                                                <div>
                                                    <label class="form-control-label" for="isCombined">
                                                        Excluir
                                                    </label>
                                                </div>
                                                <button (click)="removeTrainingPlanExercise(i)"
                                                    class="btn btn-danger btn-sm">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row p-3 bg-translucent-secondary rounded-bottom"
                                            *ngIf="trainingPlanExercise.get('isCombined').value === true && (trainingPlanExercise.get('dayOfWeek') && trainingPlanExercise.get('dayOfWeek').value == day.number)"
                                            [formGroupName]="i">
                                            <div class="col-3">
                                                <label class="form-control-label" for="exerciseCategory">
                                                    Categoria <span class="text-danger">*</span></label>
                                                <p>{{trainingPlanExercise.get('exerciseCategory') ?
                                                    trainingPlanExercise.get('exerciseCategory').value['description']
                                                    :
                                                    ''}}
                                                </p>
                                            </div>
                                            <div class="col-3">
                                                <label class="form-control-label" for="exercise">
                                                    Exercicio <span class="text-danger">*</span></label>
                                                <p>{{trainingPlanExercise.get('combinedExercise') ?
                                                    trainingPlanExercise.get('combinedExercise').value['description']
                                                    : ''}}</p>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <div class="row pt-2 mt-2"
                                        [ngClass]="{'border-left border-right border-top border-primary rounded-top': addingTrainingPlan.isCombined}"
                                        *ngIf="currentDay == day.number">
                                        <div class="col-3">
                                            <div class="form-group">
                                                <label class="form-control-label" for="exercise">
                                                    Categoria <span class="text-danger">*</span></label>
                                                <select id="exerciseCategory" [(ngModel)]="exerciseCategory"
                                                    [ngModelOptions]="{'standalone': true}" name="exerciseCategory"
                                                    class="form-control form-control-alternative"
                                                    (change)="loadExercises(exerciseCategory.id)">
                                                    <option [ngValue]="category"
                                                        *ngFor="let category of exerciseCategories">
                                                        {{category.description}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="form-group">
                                                <label class="form-control-label" for="exercise">
                                                    Exercicio <span class="text-danger">*</span></label>
                                                <select id="exercise" [(ngModel)]="addingTrainingPlan.exercise"
                                                    [ngModelOptions]="{'standalone': true}" name="exercise"
                                                    class="form-control form-control-alternative"
                                                    [readonly]="!exerciseCategory">
                                                    <option [ngValue]="exercise" *ngFor="let exercise of exercises">
                                                        {{exercise.description}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <label class="form-control-label" for="repetition">
                                                Repetição <span class="text-danger">*</span>
                                            </label>
                                            <input class="form-control form-control-alternative" type="text"
                                                name="repetition" placeholder="Ex: 3x 12 repetições" id="repetition"
                                                [(ngModel)]="addingTrainingPlan.repetition"
                                                [ngModelOptions]="{'standalone': true}">
                                        </div>
                                        <div class="col-3 align-self-center">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="isCombined"
                                                    name="isCombined" [(ngModel)]="addingTrainingPlan.isCombined"
                                                    [ngModelOptions]="{'standalone': true}" value="false">
                                                <label class="form-control-label" for="isCombined">
                                                    É combinado?
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row pt-2 bg-translucent-primary mb-2 rounded-bottom"
                                        *ngIf="addingTrainingPlan.isCombined && currentDay == day.number">
                                        <div class="col-3">
                                            <div class="form-group">
                                                <label class="form-control-label" for="combinedExerciseCategory">
                                                    Categoria <span class="text-danger">*</span></label>
                                                <select id="combinedExerciseCategory"
                                                    [(ngModel)]="combinedExerciseCategory"
                                                    [ngModelOptions]="{'standalone': true}"
                                                    name="combinedExerciseCategory"
                                                    class="form-control form-control-alternative"
                                                    (change)="loadExercises(combinedExerciseCategory.id)">
                                                    <option [ngValue]="category"
                                                        *ngFor="let category of exerciseCategories">
                                                        {{category.description}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="form-group">
                                                <label class="form-control-label" for="combinedExercise">
                                                    Exercicio <span class="text-danger">*</span></label>
                                                <select id="combinedExercise"
                                                    [(ngModel)]="addingTrainingPlan.combinedExercise"
                                                    [ngModelOptions]="{'standalone': true}" name="combinedExercise"
                                                    class="form-control form-control-alternative"
                                                    [readonly]="!combinedExerciseCategory">
                                                    <option [ngValue]="exercise" *ngFor="let exercise of exercises">
                                                        {{exercise.description}}</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" *ngIf="currentDay == day.number">
                                        <div class="col-12">
                                            <button class="btn btn-primary"
                                                [disabled]="!addingTrainingPlan.exercise || (addingTrainingPlan.isCombined && addingTrainingPlan.combinedExercise == null)"
                                                (click)="addTrainingPlanExercise()"><i class="fas fa-plus"></i>&nbsp;
                                                Salvar item</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="btn-more">
                                <button class="btn btn-outline-primary h-100" (click)="addDay()"
                                    [disabled]="!hasThisDay"><i class="fas fa-plus"></i>&nbsp;Adicionar dia</button>
                                <button class="btn btn-danger d-block" *ngIf="days.length > 1"
                                    (click)="days.pop()">Remover
                                    ultimo dia</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <ng-template #footer>
        <div class="row">
            <div class="col-6">
                <button class="btn btn-outline-primary btn-block" (click)="cancel()">Cancelar
                    alterações</button>
            </div>
            <div class="col-6">
                <button class="btn btn-primary btn-block" (click)="save()"
                    [disabled]="formEntity.invalid">Salvar</button>
            </div>
        </div>
    </ng-template>
</app-base-card>